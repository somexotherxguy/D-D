Raphael.colorwheel=function(e,t,r){function E(e,t){return{x:e,y:t}}function S(e){return e*(Math.PI/180)}function x(e,t){var n=e>0?0:180;return n+Math.atan((0-t)/(0-e))*180/Math.PI}function T(e,t){o=t;l=o/20;d=o/2;v=$(e);i=Raphael(v[0],o,o);i.safari();z();V();f.cursor=P(l);a.cursor=P(l*.5);D();v.css({height:o+"px",width:o+"px"});N(v);return C()}function N(e){$(e).css({unselectable:"on","-moz-user-select":"none","-webkit-user-select":"none"})}function C(){return{input:k,onchange:L,ondrag:A,color:F}}function k(e){m=null;p=e;$(e).keyup(function(){if(this.value.match(/^#([0-9A-F]){3}$|^#([0-9A-F]){6}$/img)){I(this.value);q(true);J()}});I(e.value);q(true);return C()}function L(e){m=e;q(false);return C()}function A(e,t){g=[e||function(){},t||function(){}];return C()}function O(e){var t,n,r;e.preventDefault();r=e.originalEvent.touches?e.originalEvent.touches[0]:e;t=r.pageX-(v.offset().left+d);n=r.pageY-(v.offset().top+d);if(h==f){R(t,n);q();J();return true}if(h==a){H(t,n);q();J();return true}}function M(e,t){e.preventDefault();$(document).on("mouseup touchend",_);$(document).on("mousemove touchmove",O);h=t;O(e);g[0](s)}function _(e){e.preventDefault();$(document).off("mouseup touchend",_);$(document).off("mousemove touchmove",O);g[1](s);J()}function D(){$([f.event.node,f.cursor[0].node]).on("mousedown touchstart",function(e){M(e,f)});$([a.b.node,a.cursor[0].node]).on("mousedown touchstart",function(e){M(e,a)})}function P(e){var t=i.set().push(i.circle(0,0,e).attr({"stroke-width":4,stroke:"#333"}),i.circle(0,0,e+2).attr({"stroke-width":1,stroke:"#FFF",opacity:.5}));t[0].node.style.cursor="crosshair";return t}function H(e,t){e=e+d;t=t+d;if(e<w.x){e=w.x}if(e>w.x+w.l){e=w.x+w.l}if(t<w.y){t=w.y}if(t>w.y+w.l){t=w.y+w.l}a.cursor.attr({cx:e,cy:t}).transform("t0,0")}function B(e){var t=Raphael.getRGB(e).hex;a.h.attr("fill",t)}function j(){return Raphael.rgb2hsb(a.h.attr("fill")).h}function F(e){var t=I(e);q(false);return t}function I(e){if(e===undefined){return s}var t=i.rect(1,1,1,1).attr({fill:e}),n=i.raphael.rgb2hsb(t.attr("fill"));H(0-w.l/2+w.l*n.s,w.l/2-w.l*n.b);R(360*n.h-90);t.remove();return C()}function q(e){var t=a.cursor.items[0].attr("cx"),n=a.cursor.items[0].attr("cy"),r={b:1-(n-w.y)/w.l,s:(t-w.x)/w.l,h:j()};s=Raphael.hsb2rgb(r.h,r.s,r.b);if(p){var i=s.hex;if(e!==true){p.value=i}if(r.b<.5){$(p).css("color","#FFF")}else{$(p).css("color","#000")}p.style.background=i}}function R(e){var t;if(arguments.length==2){t=x(arguments[0],arguments[1])}else{t=arguments[0]}var n=Math.cos(S(t))*(d-l-b);var r=Math.sin(S(t))*(d-l-b);f.cursor.attr({cx:n+d,cy:r+d}).transform("t0,0");B("hsb("+(t+90)/360+",1,1)")}function U(){if(w){return w}var e=o-l*4;w={x:e/6+l*2+b,y:e/6+l*2+b,l:e*2/3-b*2};return w}function z(){U();box=[w.x,w.y,w.l,w.l];a.h=i.rect.apply(i,box).attr({stroke:"#EEE",gradient:"0-#FFF-#000",opacity:1});a.s=i.rect.apply(i,box).attr({stroke:null,gradient:"0-#FFF-#FFF",opacity:0});a.b=i.rect.apply(i,box).attr({stroke:null,gradient:"90-#000-#FFF",opacity:0});a.b.node.style.cursor="crosshair"}function W(){var e="M -@W 0 L @W 0 L @W @H L -@W @H z";return e.replace(/@H/img,l*2).replace(/@W/img,l)}function X(e,t,n){var r=e.clone();var i=t*(255/n);var s=o/2,u=l,a=b;r.transform("t"+s+","+(s-u)+"r"+360/n*t+"t0,-"+(s-u-a)+"");r.attr({"stroke-width":0,fill:"hsb("+t*(1/n)+", 1, 0.85)"});f.hues.push(r)}function V(){var e=W(),t=i.path(e).attr({stroke:"rgba(0,0,0,0)"}).transform("t"+o/2+","+b),r=u;f.hues=i.set();for(n=0;n<r;n++){X(t,n,r)}f.event=i.circle(d,d,d-l-b).attr({"stroke-width":l*2,opacity:.01});f.outline=i.circle(d,d,d-l-b).attr({stroke:"#000","stroke-width":l*2+3,opacity:.1});f.outline.toBack();f.event.node.style.cursor="crosshair"}function J(){if({}.toString.call(m).match(/function/i)){m(s)}}var i,s,o,u=r||60,a={},f={},l,c={},h,p,d,v,m,g=[function(){},function(){}],y,b=2,w;return T(e,t)}
